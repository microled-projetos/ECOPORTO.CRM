CREATE OR REPLACE FORCE VIEW CRM.VW_PROPOSTAS_CONCOMITANTES (ID, IMPORTADORID, DESPACHANTEID, COLOADERID, COCOLOADERID, COCOLOADER2ID, DATATERMINO, HUBPORT, ACORDO, EMPRESAID, DATAINICIO, SEGMENTO) AS 
  SELECT
    Id,
    MAX(ImportadorId) AS ImportadorId,
    MAX(DespachanteId) AS DespachanteId,
    MAX(ColoaderId) AS ColoaderId,
    MAX(CoColoaderId) AS CoColoaderId,
    MAX(CoColoader2Id) AS CoColoader2Id,
    DataTermino,
    HubPort,
    Acordo,
    EmpresaId,
    DataInicio,
    Segmento
FROM
    (
        SELECT
            A.Id,
            CASE
                WHEN B.Segmento = 1 THEN
                    B.ContaId
                ELSE
                    A.ContaId
            END ImportadorId,
            CASE
                WHEN B.Segmento = 2 THEN
                    B.ContaId
                ELSE
                    A.ContaId
            END DespachanteId,                
            CASE
                WHEN B.Segmento = 3 THEN
                    B.ContaId
                ELSE
                    A.ContaId
            END ColoaderId,
            CASE
                WHEN B.Segmento = 4 THEN
                    B.ContaId
                ELSE
                    A.ContaId
            END CoColoaderId,
            CASE
                WHEN B.Segmento = 5 THEN
                    B.ContaId
                ELSE
                    A.ContaId
            END CoColoader2Id,
            A.DataTermino,
            A.HubPort,
            A.Acordo,
            A.EmpresaId,
            A.DataInicio,
            B.Segmento
        FROM
            TB_CRM_OPORTUNIDADES   A
        LEFT JOIN 
            TB_CRM_OPORTUNIDADE_CLIENTES  B ON A.Id = B.OportunidadeId
        WHERE
            A.Acordo = 0
    )
GROUP BY
    Id,        
    DataTermino,
    HubPort,
    Acordo,
    EmpresaId,
    DataInicio,
    Segmento
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio
        FROM
            (
                SELECT
                    A.Id,
                    CASE
                        WHEN B.Segmento = 1 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ImportadorId,
                    CASE
                        WHEN B.Segmento = 2 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END DespachanteId,                        
                    CASE
                        WHEN B.Segmento = 3 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ColoaderId,
                    CASE
                        WHEN B.Segmento = 4 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoaderId,
                    CASE
                        WHEN B.Segmento = 5 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoader2Id,                        
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 1
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio
        FROM
            (
                SELECT
                    A.Id,
                    CASE
                        WHEN B.Segmento = 1 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ImportadorId,
                    CASE
                        WHEN B.Segmento = 2 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END DespachanteId,                        
                    CASE
                        WHEN B.Segmento = 3 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ColoaderId,
                    CASE
                        WHEN B.Segmento = 4 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoaderId,
                    CASE
                        WHEN B.Segmento = 5 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoader2Id,                        
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 2
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
        FROM
            (
                SELECT
                    A.Id,
                    CASE
                        WHEN B.Segmento = 1 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ImportadorId,
                    CASE
                        WHEN B.Segmento = 2 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END DespachanteId,                        
                    CASE
                        WHEN B.Segmento = 3 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ColoaderId,
                    CASE
                        WHEN B.Segmento = 4 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoaderId,
                    CASE
                        WHEN B.Segmento = 5 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoader2Id,                        
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 3
UNION
SELECT
   A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
        FROM
            (
                SELECT
                    A.Id,
                    CASE
                        WHEN B.Segmento = 1 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ImportadorId,
                    CASE
                        WHEN B.Segmento = 2 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END DespachanteId,                        
                    CASE
                        WHEN B.Segmento = 3 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ColoaderId,
                    CASE
                        WHEN B.Segmento = 4 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoaderId,
                    CASE
                        WHEN B.Segmento = 5 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoader2Id,                        
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 4
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
        FROM
            (
                SELECT
                    A.Id,
                    CASE
                        WHEN B.Segmento = 1 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ImportadorId,
                    CASE
                        WHEN B.Segmento = 2 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END DespachanteId,                        
                    CASE
                        WHEN B.Segmento = 3 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END ColoaderId,
                    CASE
                        WHEN B.Segmento = 4 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoaderId,
                    CASE
                        WHEN B.Segmento = 5 THEN
                            B.ContaId
                        ELSE
                            A.ContaId
                    END CoColoader2Id,                        
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 5;



CREATE OR REPLACE FORCE VIEW CRM.VW_PROPOSTAS_CONCOMIT_CNPJ (ID, IMPORTADORID, DESPACHANTEID, COLOADERID, COCOLOADERID, COCOLOADER2ID, CNPJ_IMPORTADOR, CNPJ_DESPACHANTE, CNPJ_COLOADER, CNPJ_COCOLOADER, CNPJ_COCOLOADER2, DATATERMINO, HUBPORT, ACORDO, EMPRESAID, DATAINICIO, SEGMENTO) AS 
  SELECT
    Id,
    MAX(ImportadorId) AS ImportadorId,
    MAX(DespachanteId) AS DespachanteId,
    MAX(ColoaderId) AS ColoaderId,
    MAX(CoColoaderId) AS CoColoaderId,
    MAX(CoColoader2Id) AS CoColoader2Id,
    MAX(CNPJ_IMPORTADOR) AS CNPJ_IMPORTADOR,
    MAX(CNPJ_DESPACHANTE) AS CNPJ_DESPACHANTE,
    MAX(CNPJ_COLOADER) AS CNPJ_COLOADER,
    MAX(CNPJ_COCOLOADER) AS CNPJ_COCOLOADER,
    MAX(CNPJ_COCOLOADER2) AS CNPJ_COCOLOADER2,
    DataTermino,
    HubPort,
    Acordo,
    EmpresaId,
    DataInicio,
    Segmento
FROM
    (
        SELECT
            A.Id,
            CASE
					WHEN NVL(B.Segmento,0) = 1 THEN
						B.ContaId
					ELSE
					   CASE WHEN A.Segmento = 1 THEN A.ContaId ELSE NULL END
					END ImportadorId,
					CASE
						WHEN NVL(B.Segmento,0) = 2 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 3 THEN A.ContaId ELSE NULL END
					END DespachanteId,                
					CASE
						WHEN NVL(B.Segmento,0) = 3 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 6 THEN A.ContaId ELSE NULL END
						END ColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 4 THEN
							B.ContaId
						ELSE
							NULL
						END CoColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 5 THEN
							B.ContaId
						ELSE
							NULL
					END CoColoader2Id,            
					CASE
						WHEN  NVL(B.Segmento,0) = 1 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 1 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
					END CNPJ_IMPORTADOR,
					CASE
						WHEN  NVL(B.Segmento,0) = 2 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							CASE WHEN A.Segmento = 3 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_DESPACHANTE,                
					CASE
						WHEN  NVL(B.Segmento,0) = 3 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 6 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_COLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 4 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							NULL
						END CNPJ_COCOLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 5 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
                    NULL
						END CNPJ_COCOLOADER2,
            
            A.DataTermino,
            A.HubPort,
            A.Acordo,
            A.EmpresaId,
            A.DataInicio,
            B.Segmento
        FROM
            TB_CRM_OPORTUNIDADES   A
        LEFT JOIN 
            TB_CRM_OPORTUNIDADE_CLIENTES  B ON A.Id = B.OportunidadeId
        WHERE
            A.Acordo = 0
    )
GROUP BY
    Id,        
    DataTermino,
    HubPort,
    Acordo,
    EmpresaId,
    DataInicio,
    Segmento
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.CNPJ_IMPORTADOR,
    A.CNPJ_DESPACHANTE,
    A.CNPJ_COLOADER,
    A.CNPJ_COLOADER,
    A.CNPJ_COCOLOADER2,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id, 
            MAX(CNPJ_IMPORTADOR) AS CNPJ_IMPORTADOR,
            MAX(CNPJ_DESPACHANTE) AS CNPJ_DESPACHANTE,
            MAX(CNPJ_COLOADER) AS CNPJ_COLOADER,
            MAX(CNPJ_COCOLOADER) AS CNPJ_COCOLOADER,
            MAX(CNPJ_COCOLOADER2) AS CNPJ_COCOLOADER2,  
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio
        FROM
            (
                SELECT
                    A.Id,
                    CASE
					WHEN NVL(B.Segmento,0) = 1 THEN
						B.ContaId
					ELSE
					   CASE WHEN A.Segmento = 1 THEN A.ContaId ELSE NULL END
					END ImportadorId,
					CASE
						WHEN NVL(B.Segmento,0) = 2 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 3 THEN A.ContaId ELSE NULL END
					END DespachanteId,                
					CASE
						WHEN NVL(B.Segmento,0) = 3 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 6 THEN A.ContaId ELSE NULL END
						END ColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 4 THEN
							B.ContaId
						ELSE
							NULL
						END CoColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 5 THEN
							B.ContaId
						ELSE
							NULL
					END CoColoader2Id,            
					CASE
						WHEN  NVL(B.Segmento,0) = 1 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 1 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
					END CNPJ_IMPORTADOR,
					CASE
						WHEN  NVL(B.Segmento,0) = 2 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							CASE WHEN A.Segmento = 3 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_DESPACHANTE,                
					CASE
						WHEN  NVL(B.Segmento,0) = 3 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 6 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_COLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 4 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							NULL
						END CNPJ_COCOLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 5 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
                    NULL
						END CNPJ_COCOLOADER2,
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 1
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,   
    A.CNPJ_IMPORTADOR,
    A.CNPJ_DESPACHANTE,
    A.CNPJ_COLOADER,
    A.CNPJ_COLOADER,
    A.CNPJ_COCOLOADER2,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,    
            MAX(CNPJ_IMPORTADOR) AS CNPJ_IMPORTADOR,
            MAX(CNPJ_DESPACHANTE) AS CNPJ_DESPACHANTE,
            MAX(CNPJ_COLOADER) AS CNPJ_COLOADER,
            MAX(CNPJ_COCOLOADER) AS CNPJ_COCOLOADER,
            MAX(CNPJ_COCOLOADER2) AS CNPJ_COCOLOADER2,  
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio
        FROM
            (
                SELECT
                    A.Id,
                    CASE
					WHEN NVL(B.Segmento,0) = 1 THEN
						B.ContaId
					ELSE
					   CASE WHEN A.Segmento = 1 THEN A.ContaId ELSE NULL END
					END ImportadorId,
					CASE
						WHEN NVL(B.Segmento,0) = 2 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 3 THEN A.ContaId ELSE NULL END
					END DespachanteId,                
					CASE
						WHEN NVL(B.Segmento,0) = 3 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 6 THEN A.ContaId ELSE NULL END
						END ColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 4 THEN
							B.ContaId
						ELSE
							NULL
						END CoColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 5 THEN
							B.ContaId
						ELSE
							NULL
					END CoColoader2Id,            
					CASE
						WHEN  NVL(B.Segmento,0) = 1 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 1 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
					END CNPJ_IMPORTADOR,
					CASE
						WHEN  NVL(B.Segmento,0) = 2 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							CASE WHEN A.Segmento = 3 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_DESPACHANTE,                
					CASE
						WHEN  NVL(B.Segmento,0) = 3 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 6 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_COLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 4 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							NULL
						END CNPJ_COCOLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 5 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
                    NULL
						END CNPJ_COCOLOADER2,
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 2
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,      
    A.CNPJ_IMPORTADOR,
    A.CNPJ_DESPACHANTE,
    A.CNPJ_COLOADER,
    A.CNPJ_COLOADER,
    A.CNPJ_COCOLOADER2,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,    
            MAX(CNPJ_IMPORTADOR) AS CNPJ_IMPORTADOR,
            MAX(CNPJ_DESPACHANTE) AS CNPJ_DESPACHANTE,
            MAX(CNPJ_COLOADER) AS CNPJ_COLOADER,
            MAX(CNPJ_COCOLOADER) AS CNPJ_COCOLOADER,
            MAX(CNPJ_COCOLOADER2) AS CNPJ_COCOLOADER2,  
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
        FROM
            (
                SELECT
                    A.Id,
                    CASE
					WHEN NVL(B.Segmento,0) = 1 THEN
						B.ContaId
					ELSE
					   CASE WHEN A.Segmento = 1 THEN A.ContaId ELSE NULL END
					END ImportadorId,
					CASE
						WHEN NVL(B.Segmento,0) = 2 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 3 THEN A.ContaId ELSE NULL END
					END DespachanteId,                
					CASE
						WHEN NVL(B.Segmento,0) = 3 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 6 THEN A.ContaId ELSE NULL END
						END ColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 4 THEN
							B.ContaId
						ELSE
							NULL
						END CoColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 5 THEN
							B.ContaId
						ELSE
							NULL
					END CoColoader2Id,            
					CASE
						WHEN  NVL(B.Segmento,0) = 1 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 1 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
					END CNPJ_IMPORTADOR,
					CASE
						WHEN  NVL(B.Segmento,0) = 2 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							CASE WHEN A.Segmento = 3 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_DESPACHANTE,                
					CASE
						WHEN  NVL(B.Segmento,0) = 3 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 6 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_COLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 4 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							NULL
						END CNPJ_COCOLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 5 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
                    NULL
						END CNPJ_COCOLOADER2,
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,                
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 3
UNION
SELECT
   A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.CNPJ_IMPORTADOR,
    A.CNPJ_DESPACHANTE,
    A.CNPJ_COLOADER,
    A.CNPJ_COLOADER,
    A.CNPJ_COCOLOADER2,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,       
            MAX(CNPJ_IMPORTADOR) AS CNPJ_IMPORTADOR,
            MAX(CNPJ_DESPACHANTE) AS CNPJ_DESPACHANTE,
            MAX(CNPJ_COLOADER) AS CNPJ_COLOADER,
            MAX(CNPJ_COCOLOADER) AS CNPJ_COCOLOADER,
            MAX(CNPJ_COCOLOADER2) AS CNPJ_COCOLOADER2,  
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
        FROM
            (
                SELECT
                    A.Id,
                    CASE
					WHEN NVL(B.Segmento,0) = 1 THEN
						B.ContaId
					ELSE
					   CASE WHEN A.Segmento = 1 THEN A.ContaId ELSE NULL END
					END ImportadorId,
					CASE
						WHEN NVL(B.Segmento,0) = 2 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 3 THEN A.ContaId ELSE NULL END
					END DespachanteId,                
					CASE
						WHEN NVL(B.Segmento,0) = 3 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 6 THEN A.ContaId ELSE NULL END
						END ColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 4 THEN
							B.ContaId
						ELSE
							NULL
						END CoColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 5 THEN
							B.ContaId
						ELSE
							NULL
					END CoColoader2Id,            
					CASE
						WHEN  NVL(B.Segmento,0) = 1 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 1 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
					END CNPJ_IMPORTADOR,
					CASE
						WHEN  NVL(B.Segmento,0) = 2 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							CASE WHEN A.Segmento = 3 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_DESPACHANTE,                
					CASE
						WHEN  NVL(B.Segmento,0) = 3 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 6 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_COLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 4 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							NULL
						END CNPJ_COCOLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 5 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
                    NULL
						END CNPJ_COCOLOADER2,
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 4
UNION
SELECT
    A.Id,
    B.ContaId AS ImportadorId,
    A.DespachanteId,
    A.ColoaderId,
    A.COColoaderId,
    A.CoColoader2Id,        
    A.CNPJ_IMPORTADOR,
    A.CNPJ_DESPACHANTE,
    A.CNPJ_COLOADER,
    A.CNPJ_COLOADER,
    A.CNPJ_COCOLOADER2,        
    A.DataTermino,
    A.HubPort,
    A.Acordo,
    A.EmpresaId,
    A.DataInicio,
    B.Segmento
FROM
    (
        SELECT
            Id,
            MAX(ImportadorId) AS ImportadorId,
            MAX(DespachanteId) AS DespachanteId,
            MAX(ColoaderId) AS ColoaderId,
            MAX(CoColoaderId) AS CoColoaderId,
            MAX(CoColoader2Id) AS CoColoader2Id,    
            MAX(CNPJ_IMPORTADOR) AS CNPJ_IMPORTADOR,
            MAX(CNPJ_DESPACHANTE) AS CNPJ_DESPACHANTE,
            MAX(CNPJ_COLOADER) AS CNPJ_COLOADER,
            MAX(CNPJ_COCOLOADER) AS CNPJ_COCOLOADER,
            MAX(CNPJ_COCOLOADER2) AS CNPJ_COCOLOADER2,  
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
        FROM
            (
                SELECT
                    A.Id,
                   CASE
					WHEN NVL(B.Segmento,0) = 1 THEN
						B.ContaId
					ELSE
					   CASE WHEN A.Segmento = 1 THEN A.ContaId ELSE NULL END
					END ImportadorId,
					CASE
						WHEN NVL(B.Segmento,0) = 2 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 3 THEN A.ContaId ELSE NULL END
					END DespachanteId,                
					CASE
						WHEN NVL(B.Segmento,0) = 3 THEN
							B.ContaId
						ELSE
							CASE WHEN A.Segmento = 6 THEN A.ContaId ELSE NULL END
						END ColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 4 THEN
							B.ContaId
						ELSE
							NULL
						END CoColoaderId,
					CASE
						WHEN NVL(B.Segmento,0) = 5 THEN
							B.ContaId
						ELSE
							NULL
					END CoColoader2Id,            
					CASE
						WHEN  NVL(B.Segmento,0) = 1 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 1 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
					END CNPJ_IMPORTADOR,
					CASE
						WHEN  NVL(B.Segmento,0) = 2 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							CASE WHEN A.Segmento = 3 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_DESPACHANTE,                
					CASE
						WHEN  NVL(B.Segmento,0) = 3 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
						   CASE WHEN A.Segmento = 6 THEN  (SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = A.ContaId) ELSE NULL END
						END CNPJ_COLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 4 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
							NULL
						END CNPJ_COCOLOADER,
					CASE
						WHEN  NVL(B.Segmento,0) = 5 THEN
							(SELECT Documento FROM CRM.TB_CRM_CONTAS WHERE Id = B.ContaId)
						ELSE
                    NULL
						END CNPJ_COCOLOADER2,
                    A.DataTermino,
                    A.HubPort,
                    A.Acordo,
                    A.EmpresaId,
                    A.DataInicio,
                    B.Segmento
                FROM
                    TB_CRM_OPORTUNIDADES   A
                LEFT JOIN 
                    TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
                WHERE
                    A.Acordo = 0
            )
        GROUP BY
            Id,
            DataTermino,
            HubPort,
            Acordo,
            EmpresaId,
            DataInicio,
            Segmento
    ) A
    INNER JOIN TB_CRM_OPORTUNIDADE_CLIENTES B ON A.Id = B.OportunidadeId
WHERE
    B.Segmento = 5;




 CREATE OR REPLACE FORCE VIEW SGIPA.VW_DADOS_LISTAS_PRECOS (AUTONUM, IMPORTADOR, DESPACHANTE, CAPTADOR, COLOADER, COCOLOADER, COCOLOADER2, FLAG_ESPECIAL, FLAG_LIBERADA, FINAL_VALIDADE, FLAG_HUBPORT, FLAG_ACORDO, COD_EMPRESA, DATA_INICIO, CNPJIMPORTADOR, CNPJDESPACHANTE, CNPJCAPTADOR, CNPJCOLOADER, CNPJCOCOLOADER, CNPJCOCOLOADER2) AS 
  select    A.AUTONUM,
   IMPORTADOR,
   DESPACHANTE,
   CAPTADOR,
   COLOADER,
   COCOLOADER,
   COCOLOADER2,
   FLAG_ESPECIAL,
   FLAG_LIBERADA,
   FINAL_VALIDADE,
   FLAG_HUBPORT,
   FLAG_ACORDO,
   COD_EMPRESA,
   DATA_INICIO,    
   I.CGC AS  CNPJIMPORTADOR,
   D.CGC AS CNPJDESPACHANTE,
   C.CGC AS CNPJCAPTADOR,
   S.CGC AS CNPJCOLOADER,
   B.CGC AS CNPJCOCOLOADER,
   U.CGC AS CNPJCOCOLOADER2
 FROM (

     SELECT autonum,
            MAX (IMPORTADOR) AS Importador,
            MAX (DESPACHANTE) AS Despachante,
            MAX (CAPTADOR) AS captador,
            MAX (COLOADER) AS Coloader,
            MAX (COCOLOADER) AS Cocoloader,
            MAX (COCOLOADER2) AS Cocoloader2,
            flag_especial,
            flag_liberada,
            FINAL_VALIDADE,
            FLAG_HUBPORT,
            FLAG_ACORDO,
            cod_empresa,
            DATA_INICIO
       FROM (SELECT a.autonum,
                    CASE
                       WHEN NVL (b.tipo, 'Z') = 'I' THEN b.AUTONUM_PARCEIRO
                       ELSE A.Importador
                    END
                       IMPORTADOR,
                    CASE
                       WHEN NVL (b.tipo, 'Z') = 'D' THEN b.AUTONUM_PARCEIRO
                       ELSE A.DESPACHANTE
                    END
                       Despachante,
                    CASE
                       WHEN NVL (b.tipo, 'Z') = 'C' THEN b.AUTONUM_PARCEIRO
                       ELSE A.CAPTADOR
                    END
                       captador,
                    CASE
                       WHEN NVL (b.tipo, 'Z') = 'S' THEN b.AUTONUM_PARCEIRO
                       ELSE A.COLOADER
                    END
                       Coloader,
                    CASE
                       WHEN NVL (b.tipo, 'Z') = 'U' THEN b.AUTONUM_PARCEIRO
                       ELSE A.COCOLOADER
                    END
                       Cocoloader,
                    CASE
                       WHEN NVL (b.tipo, 'Z') = 'B' THEN b.AUTONUM_PARCEIRO
                       ELSE A.COCOLOADER2
                    END
                       Cocoloader2,
                    a.flag_especial,
                    a.flag_liberada,
                    a.FINAL_VALIDADE,
                    a.FLAG_HUBPORT,
                    A.FLAG_ACORDO,
                    a.cod_empresa,
                    a.DATA_INICIO
               FROM    tb_listas_precos a
                    LEFT JOIN
                       TB_TP_GRUPOS b
                    ON A.AUTONUM = b.AUTONUMLISTA
              WHERE flag_acordo = 0)
   GROUP BY autonum,
            flag_especial,
            flag_liberada,
            FINAL_VALIDADE,
            FLAG_HUBPORT,
            FLAG_ACORDO,
            cod_empresa,
            DATA_INICIO
   UNION
   SELECT a.autonum,
          b.autonum_parceiro AS Importador,
          Despachante,
          captador,
          Coloader,
          Cocoloader,
          Cocoloader2,
          flag_especial,
          flag_liberada,
          FINAL_VALIDADE,
          FLAG_HUBPORT,
          FLAG_ACORDO,
          a.cod_empresa,
          DATA_INICIO
     FROM    (  SELECT autonum,
                       MAX (IMPORTADOR) AS Importador,
                       MAX (DESPACHANTE) AS Despachante,
                       MAX (CAPTADOR) AS captador,
                       MAX (COLOADER) AS Coloader,
                       MAX (COCOLOADER) AS Cocoloader,
                       MAX (COCOLOADER2) AS Cocoloader2,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO
                  FROM (SELECT a.autonum,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'I'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.Importador
                               END
                                  IMPORTADOR,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'D'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.DESPACHANTE
                               END
                                  Despachante,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'C'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.CAPTADOR
                               END
                                  captador,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'S'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COLOADER
                               END
                                  Coloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'U'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER
                               END
                                  Cocoloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'B'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER2
                               END
                                  Cocoloader2,
                               a.flag_especial,
                               a.flag_liberada,
                               a.FINAL_VALIDADE,
                               a.FLAG_HUBPORT,
                               A.FLAG_ACORDO,
                               a.cod_empresa,
                               a.DATA_INICIO
                          FROM    tb_listas_precos a
                               LEFT JOIN
                                  TB_TP_GRUPOS b
                               ON A.AUTONUM = b.AUTONUMLISTA
                         WHERE flag_acordo = 0)
              GROUP BY autonum,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO) a
          INNER JOIN
             TB_TP_GRUPOS b
          ON a.autonum = b.AUTONUMLISTA
    WHERE b.TIPO = 'I'
   UNION
   SELECT a.autonum,
          Importador,
          b.autonum_parceiro AS Despachante,
          captador,
          Coloader,
          Cocoloader,
          Cocoloader2,
          flag_especial,
          flag_liberada,
          FINAL_VALIDADE,
          FLAG_HUBPORT,
          FLAG_ACORDO,
          a.cod_empresa,
          DATA_INICIO
     FROM    (  SELECT autonum,
                       MAX (IMPORTADOR) AS Importador,
                       MAX (DESPACHANTE) AS Despachante,
                       MAX (CAPTADOR) AS captador,
                       MAX (COLOADER) AS Coloader,
                       MAX (COCOLOADER) AS Cocoloader,
                       MAX (COCOLOADER2) AS Cocoloader2,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO
                  FROM (SELECT a.autonum,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'I'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.Importador
                               END
                                  IMPORTADOR,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'D'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.DESPACHANTE
                               END
                                  Despachante,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'C'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.CAPTADOR
                               END
                                  captador,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'S'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COLOADER
                               END
                                  Coloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'U'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER
                               END
                                  Cocoloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'B'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER2
                               END
                                  Cocoloader2,
                               a.flag_especial,
                               a.flag_liberada,
                               a.FINAL_VALIDADE,
                               a.FLAG_HUBPORT,
                               A.FLAG_ACORDO,
                               a.cod_empresa,
                               a.DATA_INICIO
                          FROM    tb_listas_precos a
                               LEFT JOIN
                                  TB_TP_GRUPOS b
                               ON A.AUTONUM = b.AUTONUMLISTA
                         WHERE flag_acordo = 0)
              GROUP BY autonum,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO) a
          INNER JOIN
             TB_TP_GRUPOS b
          ON a.autonum = b.AUTONUMLISTA
    WHERE b.TIPO = 'D'
   UNION
   SELECT a.autonum,
          Importador,
          Despachante,
          b.autonum_parceiro AS captador,
          Coloader,
          Cocoloader,
          Cocoloader2,
          flag_especial,
          flag_liberada,
          FINAL_VALIDADE,
          FLAG_HUBPORT,
          FLAG_ACORDO,
          a.cod_empresa,
          DATA_INICIO
     FROM    (  SELECT autonum,
                       MAX (IMPORTADOR) AS Importador,
                       MAX (DESPACHANTE) AS Despachante,
                       MAX (CAPTADOR) AS captador,
                       MAX (COLOADER) AS Coloader,
                       MAX (COCOLOADER) AS Cocoloader,
                       MAX (COCOLOADER2) AS Cocoloader2,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO
                  FROM (SELECT a.autonum,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'I'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.Importador
                               END
                                  IMPORTADOR,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'D'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.DESPACHANTE
                               END
                                  Despachante,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'C'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.CAPTADOR
                               END
                                  captador,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'S'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COLOADER
                               END
                                  Coloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'U'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER
                               END
                                  Cocoloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'B'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER2
                               END
                                  Cocoloader2,
                               a.flag_especial,
                               a.flag_liberada,
                               a.FINAL_VALIDADE,
                               a.FLAG_HUBPORT,
                               A.FLAG_ACORDO,
                               a.cod_empresa,
                               a.DATA_INICIO
                          FROM    tb_listas_precos a
                               LEFT JOIN
                                  TB_TP_GRUPOS b
                               ON A.AUTONUM = b.AUTONUMLISTA
                         WHERE flag_acordo = 0)
              GROUP BY autonum,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO) a
          INNER JOIN
             TB_TP_GRUPOS b
          ON a.autonum = b.AUTONUMLISTA
    WHERE b.TIPO = 'C'
   UNION
   SELECT a.autonum,
          Importador,
          Despachante,
          captador,
          b.autonum_parceiro AS Coloader,
          Cocoloader,
          Cocoloader2,
          flag_especial,
          flag_liberada,
          FINAL_VALIDADE,
          FLAG_HUBPORT,
          FLAG_ACORDO,
          a.cod_empresa,
          DATA_INICIO
     FROM    (  SELECT autonum,
                       MAX (IMPORTADOR) AS Importador,
                       MAX (DESPACHANTE) AS Despachante,
                       MAX (CAPTADOR) AS captador,
                       MAX (COLOADER) AS Coloader,
                       MAX (COCOLOADER) AS Cocoloader,
                       MAX (COCOLOADER2) AS Cocoloader2,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO
                  FROM (SELECT a.autonum,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'I'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.Importador
                               END
                                  IMPORTADOR,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'D'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.DESPACHANTE
                               END
                                  Despachante,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'C'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.CAPTADOR
                               END
                                  captador,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'S'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COLOADER
                               END
                                  Coloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'U'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER
                               END
                                  Cocoloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'B'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER2
                               END
                                  Cocoloader2,
                               a.flag_especial,
                               a.flag_liberada,
                               a.FINAL_VALIDADE,
                               a.FLAG_HUBPORT,
                               A.FLAG_ACORDO,
                               a.cod_empresa,
                               a.DATA_INICIO
                          FROM    tb_listas_precos a
                               LEFT JOIN
                                  TB_TP_GRUPOS b
                               ON A.AUTONUM = b.AUTONUMLISTA
                         WHERE flag_acordo = 0)
              GROUP BY autonum,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO) a
          INNER JOIN
             TB_TP_GRUPOS b
          ON a.autonum = b.AUTONUMLISTA
    WHERE b.TIPO = 'S'
   UNION
   SELECT a.autonum,
          Importador,
          Despachante,
          captador,
          Coloader,
          b.autonum_parceiro AS Cocoloader,
          Cocoloader2,
          flag_especial,
          flag_liberada,
          FINAL_VALIDADE,
          FLAG_HUBPORT,
          FLAG_ACORDO,
          a.cod_empresa,
          DATA_INICIO
     FROM    (  SELECT autonum,
                       MAX (IMPORTADOR) AS Importador,
                       MAX (DESPACHANTE) AS Despachante,
                       MAX (CAPTADOR) AS captador,
                       MAX (COLOADER) AS Coloader,
                       MAX (COCOLOADER) AS Cocoloader,
                       MAX (COCOLOADER2) AS Cocoloader2,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO
                  FROM (SELECT a.autonum,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'I'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.Importador
                               END
                                  IMPORTADOR,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'D'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.DESPACHANTE
                               END
                                  Despachante,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'C'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.CAPTADOR
                               END
                                  captador,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'S'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COLOADER
                               END
                                  Coloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'U'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER
                               END
                                  Cocoloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'B'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER2
                               END
                                  Cocoloader2,
                               a.flag_especial,
                               a.flag_liberada,
                               a.FINAL_VALIDADE,
                               a.FLAG_HUBPORT,
                               A.FLAG_ACORDO,
                               a.cod_empresa,
                               a.DATA_INICIO
                          FROM    tb_listas_precos a
                               LEFT JOIN
                                  TB_TP_GRUPOS b
                               ON A.AUTONUM = b.AUTONUMLISTA
                         WHERE flag_acordo = 0)
              GROUP BY autonum,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO) a
          INNER JOIN
             TB_TP_GRUPOS b
          ON a.autonum = b.AUTONUMLISTA
    WHERE b.TIPO = 'U'
   UNION
   SELECT a.autonum,
          Importador,
          Despachante,
          captador,
          Coloader,
          Cocoloader,
          b.autonum_parceiro AS Cocoloader2,
          flag_especial,
          flag_liberada,
          FINAL_VALIDADE,
          FLAG_HUBPORT,
          FLAG_ACORDO,
          a.cod_empresa,
          DATA_INICIO
     FROM    (  SELECT autonum,
                       MAX (IMPORTADOR) AS Importador,
                       MAX (DESPACHANTE) AS Despachante,
                       MAX (CAPTADOR) AS captador,
                       MAX (COLOADER) AS Coloader,
                       MAX (COCOLOADER) AS Cocoloader,
                       MAX (COCOLOADER2) AS Cocoloader2,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO
                  FROM (SELECT a.autonum,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'I'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.Importador
                               END
                                  IMPORTADOR,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'D'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.DESPACHANTE
                               END
                                  Despachante,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'C'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.CAPTADOR
                               END
                                  captador,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'S'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COLOADER
                               END
                                  Coloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'U'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER
                               END
                                  Cocoloader,
                               CASE
                                  WHEN NVL (b.tipo, 'Z') = 'B'
                                  THEN
                                     b.AUTONUM_PARCEIRO
                                  ELSE
                                     A.COCOLOADER2
                               END
                                  Cocoloader2,
                               a.flag_especial,
                               a.flag_liberada,
                               a.FINAL_VALIDADE,
                               a.FLAG_HUBPORT,
                               A.FLAG_ACORDO,
                               a.cod_empresa,
                               a.DATA_INICIO
                          FROM    tb_listas_precos a
                               LEFT JOIN
                                  TB_TP_GRUPOS b
                               ON A.AUTONUM = b.AUTONUMLISTA
                         WHERE flag_acordo = 0)
              GROUP BY autonum,
                       flag_especial,
                       flag_liberada,
                       FINAL_VALIDADE,
                       FLAG_HUBPORT,
                       FLAG_ACORDO,
                       cod_empresa,
                       DATA_INICIO) a
          INNER JOIN
             TB_TP_GRUPOS b
          ON a.autonum = b.AUTONUMLISTA
    WHERE b.TIPO = 'B') A
   LEFT JOIN TB_CAD_PARCEIROS I ON A.IMPORTADOR=I.AUTONUM
   LEFT JOIN TB_CAD_PARCEIROS D ON A.DESPACHANTE=D.AUTONUM
   LEFT JOIN TB_CAD_PARCEIROS C ON A.CAPTADOR=C.AUTONUM
   LEFT JOIN TB_CAD_PARCEIROS S ON A.COLOADER=S.AUTONUM
   LEFT JOIN TB_CAD_PARCEIROS B ON A.COCOLOADER=B.AUTONUM
   LEFT JOIN TB_CAD_PARCEIROS U ON A.COCOLOADER2=U.AUTONUM;
